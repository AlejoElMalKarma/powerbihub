<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Power BI Learning Hub - AI User Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .pbi-yellow { background-color: #F2C811; }
        .pbi-yellow-text { color: #F2C811; }
        .pbi-dark { background-color: #212121; }
        .card-hover:hover { transform: translateY(-5px); transition: all 0.3s ease; }
        .glossary-item:hover { background-color: #fefce8; border-color: #F2C811; }
        
        /* IA Loader styles */
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #F2C811;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 pbi-dark text-white shadow-md border-b border-white/10">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="pbi-yellow h-8 w-8 rounded flex items-center justify-center">
                    <i class="fa-solid fa-chart-bar text-black text-xl"></i>
                </div>
                <span class="text-xl font-extrabold tracking-tight">Power BI Hub</span>
            </div>
            <div class="hidden md:flex space-x-8 font-semibold text-sm uppercase tracking-wider items-center">
                <a href="#inicio" class="hover:text-yellow-400 transition">Home</a>
                <a href="#rutas" class="hover:text-yellow-400 transition">Paths</a>
                <a href="#ia-tools" class="hover:text-yellow-400 transition">✨ AI Assistant</a>
                <a href="#glosario" class="hover:text-yellow-400 transition">Glossary</a>
                <a href="#recursos" class="hover:text-yellow-400 transition">Resources</a>
                <!-- Settings Trigger -->
                <button onclick="toggleSettings()" class="text-slate-400 hover:text-white ml-4 p-2 rounded-full border border-slate-700 hover:border-slate-500 transition">
                    <i class="fa-solid fa-cog"></i>
                </button>
            </div>
            <button class="md:hidden text-white">
                <i class="fa-solid fa-bars text-2xl"></i>
            </button>
        </div>
    </nav>

    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-black/60 backdrop-blur-sm px-4">
        <div class="bg-white rounded-3xl p-8 max-w-md w-full shadow-2xl">
            <h3 class="text-2xl font-bold mb-4 flex items-center">
                <i class="fa-solid fa-key mr-3 text-yellow-500"></i> API Configuration
            </h3>
            <p class="text-sm text-slate-600 mb-6">
                To use the AI features on GitHub Pages, you need a <strong>Gemini API Key</strong>. Get one for free at <a href="https://aistudio.google.com/" target="_blank" class="text-blue-600 underline">Google AI Studio</a>.
            </p>
            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-bold uppercase text-slate-400 mb-2">Gemini API Key</label>
                    <input type="password" id="user-api-key" placeholder="Paste your AI Studio Key here..." class="w-full p-4 bg-slate-100 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-yellow-400">
                </div>
                <div class="flex space-x-3">
                    <button onclick="saveApiKey()" class="flex-grow py-3 pbi-yellow text-black font-bold rounded-xl hover:bg-yellow-500 transition">Save Changes</button>
                    <button onclick="toggleSettings()" class="px-6 py-3 bg-slate-200 text-slate-700 font-bold rounded-xl hover:bg-slate-300 transition">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Hero Section -->
    <header id="inicio" class="relative bg-white pt-20 pb-32 overflow-hidden">
        <div class="container mx-auto px-6 relative z-10 text-center">
            <span class="inline-block py-1 px-3 rounded-full bg-yellow-100 text-yellow-700 text-xs font-bold uppercase mb-4">Updated for 2026 + AI</span>
            <h1 class="text-5xl md:text-6xl font-black mb-6 leading-tight text-slate-900">
                Master Power BI with <span class="pbi-yellow-text">Artificial Intelligence</span>
            </h1>
            <p class="text-xl text-slate-600 max-w-3xl mx-auto mb-10">
                Learn faster with our smart assistant and access all centralized official documentation in one place.
            </p>
            <div class="flex flex-col md:flex-row justify-center space-y-4 md:space-y-0 md:space-x-4">
                <a href="#ia-tools" class="pbi-yellow text-black px-8 py-4 rounded-lg font-bold shadow-lg hover:bg-yellow-500 transition-all flex items-center justify-center">
                    ✨ Try AI Assistant <i class="fa-solid fa-sparkles ml-2"></i>
                </a>
                <a href="#recursos" class="bg-slate-900 text-white px-8 py-4 rounded-lg font-bold shadow-lg hover:bg-slate-800 transition-all">
                    View Documentation
                </a>
            </div>
        </div>
        <div class="absolute top-0 right-0 -translate-y-12 translate-x-12 opacity-5 pointer-events-none text-slate-900">
            <i class="fa-solid fa-brain text-[25rem]"></i>
        </div>
    </header>

    <!-- AI Intelligence Center -->
    <section id="ia-tools" class="py-24 bg-slate-50 border-y border-slate-200">
        <div class="container mx-auto px-6 text-slate-900">
            <div class="text-center mb-16">
                <h2 class="text-4xl font-bold mb-4">✨ AI Intelligence Center</h2>
                <p class="text-slate-500 max-w-2xl mx-auto">Use the configuration icon above to set your API Key if you are outside the preview environment.</p>
            </div>

            <div class="grid lg:grid-cols-3 gap-8">
                <!-- DAX Generator -->
                <div class="bg-white p-8 rounded-3xl shadow-lg border border-slate-100">
                    <div class="flex items-center mb-6">
                        <div class="bg-yellow-100 p-3 rounded-xl mr-4">
                            <i class="fa-solid fa-calculator text-yellow-600 text-xl"></i>
                        </div>
                        <h3 class="text-xl font-bold">✨ DAX Generator</h3>
                    </div>
                    <p class="text-sm text-slate-500 mb-4">Describe what you want to calculate and the AI will create the formula.</p>
                    <textarea id="dax-prompt" placeholder="E.g.: Sum of sales from previous year compared to current..." class="w-full h-24 p-4 text-sm bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-yellow-400 outline-none mb-4 resize-none"></textarea>
                    <button onclick="generateDAX()" id="btn-dax" class="w-full py-3 pbi-yellow text-black font-bold rounded-xl hover:bg-yellow-500 transition">
                        ✨ Generate Formula
                    </button>
                    <div id="dax-result" class="mt-4 p-4 bg-slate-900 text-green-400 font-mono text-xs rounded-xl hidden whitespace-pre-wrap"></div>
                </div>

                <!-- Executive Summary -->
                <div class="bg-white p-8 rounded-3xl shadow-lg border border-slate-100">
                    <div class="flex items-center mb-6">
                        <div class="bg-blue-100 p-3 rounded-xl mr-4">
                            <i class="fa-solid fa-file-lines text-blue-600 text-xl"></i>
                        </div>
                        <h3 class="text-xl font-bold">✨ Executive Summary</h3>
                    </div>
                    <p class="text-sm text-slate-500 mb-4">Paste a project description and get a clear high-level summary.</p>
                    <textarea id="summary-prompt" placeholder="Paste the technical details of your project or report here..." class="w-full h-24 p-4 text-sm bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-400 outline-none mb-4 resize-none"></textarea>
                    <button onclick="generateSummary()" id="btn-summary" class="w-full py-3 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 transition">
                        ✨ Summarize Data
                    </button>
                    <div id="summary-result" class="mt-4 p-4 bg-blue-50 text-blue-800 text-xs rounded-xl hidden"></div>
                </div>

                <!-- Error Help -->
                <div class="bg-white p-8 rounded-3xl shadow-lg border border-slate-100">
                    <div class="flex items-center mb-6">
                        <div class="bg-red-100 p-3 rounded-xl mr-4">
                            <i class="fa-solid fa-bug text-red-600 text-xl"></i>
                        </div>
                        <h3 class="text-xl font-bold">✨ Error Mentor</h3>
                    </div>
                    <p class="text-sm text-slate-500 mb-4">Something not working? Describe the error to receive instant help.</p>
                    <textarea id="error-prompt" placeholder="E.g.: Error refreshing gateway or Power BI visual issue..." class="w-full h-24 p-4 text-sm bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-red-400 outline-none mb-4 resize-none"></textarea>
                    <button onclick="fixError()" id="btn-error" class="w-full py-3 bg-red-600 text-white font-bold rounded-xl hover:bg-red-700 transition">
                        ✨ Fix Error
                    </button>
                    <div id="error-result" class="mt-4 p-4 bg-red-50 text-red-800 text-xs rounded-xl hidden"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Learning Paths, Glossary, and Resources sections remain unchanged -->
    <!-- [Placeholder for sections defined in previous version] -->
    <section id="rutas" class="py-24 container mx-auto px-6">
        <div class="text-center mb-16 text-slate-900">
            <h2 class="text-3xl font-bold mb-4">User Profile Paths</h2>
            <p class="text-slate-500">Structured content based on the master guide.</p>
        </div>
        <div class="grid lg:grid-cols-3 gap-10">
            <!-- Simplified placeholders for brevity -->
            <div class="bg-white p-8 rounded-3xl shadow-xl border-t-4 border-green-500">
                <h3 class="text-2xl font-bold mb-2 text-slate-900">Consumer</h3>
                <p class="text-sm text-slate-600 italic mb-4">"Navigating and filtering insights."</p>
                <ul class="text-sm space-y-2 text-slate-600">
                    <li><i class="fa-solid fa-check text-green-500 mr-2"></i>Web Service Navigation</li>
                    <li><i class="fa-solid fa-check text-green-500 mr-2"></i>Slicers & Filter usage</li>
                </ul>
            </div>
            <div class="bg-white p-8 rounded-3xl shadow-xl border-t-4 border-blue-500 scale-105">
                <h3 class="text-2xl font-bold mb-2 text-slate-900">Analyst</h3>
                <p class="text-sm text-slate-600 italic mb-4">"Creating and sharing findings."</p>
                <ul class="text-sm space-y-2 text-slate-600">
                    <li><i class="fa-solid fa-check text-blue-500 mr-2"></i>DAX & Personal Dashboards</li>
                    <li><i class="fa-solid fa-check text-blue-500 mr-2"></i>Teams & Excel integration</li>
                </ul>
            </div>
            <div class="bg-white p-8 rounded-3xl shadow-xl border-t-4 border-purple-500">
                <h3 class="text-2xl font-bold mb-2 text-slate-900">Architect</h3>
                <p class="text-sm text-slate-600 italic mb-4">"Governing and optimizing data."</p>
                <ul class="text-sm space-y-2 text-slate-600">
                    <li><i class="fa-solid fa-check text-purple-500 mr-2"></i>RLS Security & Star Schema</li>
                    <li><i class="fa-solid fa-check text-purple-500 mr-2"></i>Admin & Apps Publishing</li>
                </ul>
            </div>
        </div>
    </section>

    <section id="glosario" class="py-24 bg-slate-900 text-white">
        <div class="container mx-auto px-6">
            <h2 class="text-4xl font-bold mb-4 pbi-yellow-text">Glossary</h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="glossary-item p-6 rounded-2xl bg-white/5 border border-white/10 transition-all">
                    <h4 class="font-bold text-lg mb-2 pbi-yellow-text">Semantic Model</h4>
                    <p class="text-sm text-slate-300">Formerly 'Dataset'. The underlying logic including tables, relationships, and measures.</p>
                </div>
                <div class="glossary-item p-6 rounded-2xl bg-white/5 border border-white/10 transition-all">
                    <h4 class="font-bold text-lg mb-2 pbi-yellow-text">Drill-through</h4>
                    <p class="text-sm text-slate-300">Navigating from a summary visual to a detailed report page automatically filtered by context.</p>
                </div>
                <div class="glossary-item p-6 rounded-2xl bg-white/5 border border-white/10 transition-all">
                    <h4 class="font-bold text-lg mb-2 pbi-yellow-text">Gateway</h4>
                    <p class="text-sm text-slate-300">A secure bridge that allows the Power BI Service to access data stored on-premises.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="recursos" class="py-24 container mx-auto px-6">
        <div class="text-center mb-16 text-slate-900">
            <h2 class="text-4xl font-bold mb-4">Resources</h2>
            <div class="grid md:grid-cols-3 gap-6">
                <a href="https://learn.microsoft.com/en-us/power-bi/" target="_blank" class="p-6 bg-white rounded-2xl border border-slate-100 hover:shadow-lg transition">Documentation</a>
                <a href="https://learn.microsoft.com/en-us/training/powerplatform/power-bi" target="_blank" class="p-6 bg-white rounded-2xl border border-slate-100 hover:shadow-lg transition">Microsoft Learn</a>
                <a href="https://community.powerbi.com/" target="_blank" class="p-6 bg-white rounded-2xl border border-slate-100 hover:shadow-lg transition">Community</a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="pbi-dark py-12 text-white/50 text-center">
        <div class="container mx-auto px-6">
            <p class="text-xs">&copy; 2026 Power BI Study Guide + Gemini AI.</p>
        </div>
    </footer>

    <script>
        // Internal environment Key (empty string as mandated, overridden by user input if deployed)
        let internalApiKey = ""; 
        const modelName = "gemini-2.5-flash-preview-09-2025";

        // Toggle Settings Modal
        function toggleSettings() {
            document.getElementById('settings-modal').classList.toggle('hidden');
        }

        // Save Key for the session
        function saveApiKey() {
            const key = document.getElementById('user-api-key').value.trim();
            if (key) {
                internalApiKey = key;
                alert("API Key saved successfully for this session.");
                toggleSettings();
            } else {
                alert("Please enter a valid key.");
            }
        }

        async function callGemini(prompt, systemInstruction) {
            // Priority: Environment provided key (if any) or user-provided key
            const apiKeyToUse = internalApiKey || ""; 
            
            if (!apiKeyToUse) {
                toggleSettings();
                return "ERROR: Missing API Key. Please click the settings icon (top right) and enter your Gemini API Key.";
            }

            const url = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKeyToUse}`;
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: systemInstruction }] }
            };

            let delay = 1000;
            for (let i = 0; i < 5; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (response.status === 401 || response.status === 403) {
                        return "ERROR: Invalid API Key. Please check your settings.";
                    }
                    
                    if (!response.ok) throw new Error('API Error');
                    const data = await response.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text || "Could not generate a response.";
                } catch (error) {
                    if (i === 4) return "Connection error. Please check your internet or API Key.";
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
            }
        }

        async function generateDAX() {
            const prompt = document.getElementById('dax-prompt').value;
            const btn = document.getElementById('btn-dax');
            const resultDiv = document.getElementById('dax-result');
            if (!prompt) return;
            btn.disabled = true;
            btn.innerHTML = `<span class="loader"></span> Generating...`;
            resultDiv.classList.add('hidden');
            const instruction = "You are a Microsoft Power BI expert. Generate correct, production-ready DAX formulas. Return ONLY the formula and a one-line explanation.";
            const response = await callGemini(prompt, instruction);
            resultDiv.textContent = response;
            resultDiv.classList.remove('hidden');
            btn.disabled = false;
            btn.innerHTML = `✨ Generate Formula`;
        }

        async function generateSummary() {
            const prompt = document.getElementById('summary-prompt').value;
            const btn = document.getElementById('btn-summary');
            const resultDiv = document.getElementById('summary-result');
            if (!prompt) return;
            btn.disabled = true;
            btn.innerHTML = `<span class="loader"></span> Summarizing...`;
            resultDiv.classList.add('hidden');
            const instruction = "You are a senior data analyst. Summarize the technical details into 3 executive actionable insights.";
            const response = await callGemini(prompt, instruction);
            resultDiv.textContent = response;
            resultDiv.classList.remove('hidden');
            btn.disabled = false;
            btn.innerHTML = `✨ Summarize Data`;
        }

        async function fixError() {
            const prompt = document.getElementById('error-prompt').value;
            const btn = document.getElementById('btn-error');
            const resultDiv = document.getElementById('error-result');
            if (!prompt) return;
            btn.disabled = true;
            btn.innerHTML = `<span class="loader"></span> Analyzing...`;
            resultDiv.classList.add('hidden');
            const instruction = "You are a Power BI support specialist. Provide a step-by-step solution for the described technical error.";
            const response = await callGemini(prompt, instruction);
            resultDiv.textContent = response;
            resultDiv.classList.remove('hidden');
            btn.disabled = false;
            btn.innerHTML = `✨ Fix Error`;
        }
    </script>
</body>
</html>
